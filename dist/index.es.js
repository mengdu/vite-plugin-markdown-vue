var e=Object.defineProperty,n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(n,t,r)=>t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,o=(e,o)=>{for(var s in o||(o={}))t.call(o,s)&&i(e,s,o[s]);if(n)for(var s of n(o))r.call(o,s)&&i(e,s,o[s]);return e};import{createFilter as s}from"@rollup/pluginutils";import l from"markdown-it";import c from"highlight.js";import a from"markdown-it-anchor";import m from"uslug";import p from"markdown-it-container";import{compileTemplate as u,TemplateCompiler as f}from"@vue/compiler-sfc";var d=e=>{e.use(p,"tip"),e.use(p,"warning"),e.use(p,"spoiler",{validate:function(e){return e.trim().match(/^spoiler\s+(.*)$/)},render:function(n,t){var r=n[t].info.trim().match(/^spoiler\s+(.*)$/);return 1===n[t].nesting?"<details><summary>"+e.utils.escapeHtml(r[1])+"</summary>\n":"</details>\n"}}),e.use(p,"demo",{validate:e=>e.trim().match(/^demo\s*(.*)$/),render(n,t){const r=n[t].info.trim().match(/^demo\s*(.*)$/);if(1===n[t].nesting){const i=r&&r.length>1?r[1]:"",o="fence"===n[t+1].type?n[t+1].content:"";return`<demo-block>\n          ${i?`<div>${e.render(i)}</div>`:""}\n          \x3c!--element-demo: ${o}:element-demo--\x3e`}return"</demo-block>"}});const n=e.renderer.rules.fence;e.renderer.rules.fence=(e,t,r,i,o)=>{const s=e[t],l=e[t-1],c=l&&1===l.nesting&&l.info.trim().match(/^demo\s*(.*)$/);return/^html/.test(s.info)&&c?`<template #highlight>${n(e,t,r,i,o)}</template>`:n(e,t,r,i,o)}};const h=/{([\d,-]+)}/,$=/^<pre .*?><code>/;var g=e=>{const n=e.renderer.rules.fence;e.renderer.rules.fence=(...e)=>{const[t,r,i]=e,o=t[r];if(!o.lineNumbers){const t=o.info;if(!t||!h.test(t))return n(...e);const r=t.replace(h,"").trim();o.info=r,o.lineNumbers=h.exec(t)[1].split(",").map((e=>e.split("-").map((e=>parseInt(e,10)))))}const s=i.highlight?i.highlight(o.content,o.info):o.content;return`<div class="hljs-diff-block"><div class="hljs-lines">${s.replace($,"").split("\n").map(((e,n)=>{const t=n+1;return o.lineNumbers.some((([e,n])=>e&&n?t>=e&&t<=n:t===e))?'<div class="highlighted">&nbsp;</div>':"<br/>"})).join("")}</div>${s}</div>`}};function v(e,n,t){let r=e;if(n&&c.getLanguage(n))try{r=c.highlight(e,{language:n,ignoreIllegals:!0}).value}catch(i){}else{const t=c.highlightAuto(e);r=t.value,n=t.language||""}return`<pre class="hljs" data-lang="${n}"><code>${r}</code></pre>`}function y(e){const n=new l(o({html:!0,linkify:!0,typographer:!0,highlight:v},e));return n.linkify.set({fuzzyLink:!1}),n.use(g),n.use(d),n.use(a,o({permalink:a.permalink.linkInsideHeader({class:"anchor",symbol:'<span class="octicon octicon-link"></span>',placement:"before"}),slugify:e=>m(e)},e.anchor)),e&&e.setup&&e.setup(n),n}const b=/<template>([\s\S]+)<\/template>/g;function x(e){const n=e.match(/<(script)>([\s\S]+)<\/\1>/);return n&&n[2]?n[2].trim():""}function k(e){return(e=e.trim())?e.replace(/<(script|style)[\s\S]+<\/\1>/g,"").trim():e}function j(e,n){let t=e;b.test(t)&&(t=t.replace(b,"$1"));const r=u({source:`<div>${t}</div>`,filename:"inline-component",compiler:f,compilerOptions:{mode:"function"}});r.tips&&r.tips.length&&r.tips.forEach((e=>{console.warn(e)})),r.errors&&r.errors.length&&console.error(`\n  Error compiling template:\n${function(e){return e.split(/\r?\n/).map((e=>`  ${e}`)).join("\n")}(r.source)}\n`+r.errors.map((e=>`  - ${e}`)).join("\n")+"\n");let i=`\n    ${r.code.replace("return function render","function render")}\n  `;n=n.trim();const o="$$$blockDemoExport";return i=`(function() {\n    ${i}\n    ${n=n?n.replace(/export\s+default/,(()=>`const ${o} =`)).replace(/import ({.*}) from 'vue'/g,((e,n)=>`const ${n} = Vue`)):`const ${o} = {}`}\n    return {\n      render,\n      ...${o}\n    }\n  })()`,i}const w=y;function O(e,n,t={}){const r=n.render(e),i="\x3c!--element-demo:",o=i.length,s=":element-demo--\x3e",l=s.length,c=[];let a=0,m=[],p=0,u=r.indexOf(i),f=r.indexOf(s,u+o);for(;-1!==u&&-1!==f;){m.push(r.slice(p,u));const e=r.slice(u+o,f),n=k(e),t=x(e),d=`block-demo-${a}`;m.push(`<template #source><${d} /></template>`),c.push([JSON.stringify(d),j(n,t)]),a++,p=f+l,u=r.indexOf(i,p),f=r.indexOf(s,u+o)}m.push(r.slice(p));let d="",h="";const $=`\n    <template>\n      \x3c!-- eslint-disable --\x3e\n      <section class="markdown ${t.className||"content"}">\n      ${m.join("")}\n      </section>\n    </template>`.replace(/<script>([\s\S]+?)<\/script>/g,(function(e){if(!d)if(c.length>0){const n="$$$exportDefault",t="$$$componenetMixins",r=`const ${t} = {\n            components: {\n${c.map((e=>`${e[0]}: ${e[1]}`)).join(",\n")}\n}\n          }`,i=`if (${n}.mixins) {\n            ${n}.mixins.push(${t})\n          } else {\n            ${n}.mixins = [${t}]\n          }\n          `;d=e.replace(/export +default/,(()=>`const ${n} =`)).replace(/<\/script>/,(()=>`${r}\n${i}\nexport default ${n}\n<\/script>`))}else d=e;return""})).replace(/<style( +.*)?>([\s\S]+?)<\/style>/g,(function(e){return h=e,""}));return d||(d=`<script>\n      /** eslint-disable **/\n      import * as Vue from 'vue'\n      export default {\n        components: {\n          ${c.map((e=>e[0]+": "+e[1])).join(",\n")}\n        }\n      }\n    <\/script>`),[$,d,h].filter((e=>!!e)).join("\n")}function S(e={}){const n=s(e.include||/\.md$/,e.exclude),t=y(e.markdown||{});return{name:"vite-plugin-markdown-vue",enforce:"pre",transform:async(r,i)=>n(i)?O(r,t,e):null,async handleHotUpdate(r){if(!n(r.file))return;const i=r.read;r.read=async function(){return O(await i(),t,e)}}}}export{w as createMarkdown,S as default,O as transformToVueCode};
